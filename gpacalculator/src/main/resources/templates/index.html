<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPA Calculator</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        table { width: 50%; margin: auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; }
        th { background-color: #f2f2f2; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>GPA Calculator</h2>
    
    <label>Course Name:</label>
    <input type="text" id="courseName"><br><br>
    
    <label>Credits:</label>
    <input type="number" id="credits"><br><br>
    
    <label>Grade:</label>
    <select id="grade">
        <option value="A+">A+</option>
        <option value="A">A</option>
        <option value="B+">B+</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
        <option value="F">F</option>
    </select><br><br>
    
    <button onclick="addGrade()">Add Grade</button>
    <button onclick="calculateGPA()">Calculate GPA</button>
    
    <h3>Grades List:</h3>
    <table>
        <thead>
            <tr>
                <th>Course</th>
                <th>Credits</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody id="gradesTable"></tbody>
    </table>
    
    <h3>GPA: <span id="gpa">0.00</span></h3>

    <script>
        function addGrade() {
            let courseName = $("#courseName").val();
            let credits = $("#credits").val();
            let grade = $("#grade").val();

            if (!courseName || !credits || !grade) {
                alert("Please fill in all fields.");
                return;
            }

            $.ajax({
                type: "POST",
                url: "/grades/add",
                data: { 
                    courseName: courseName, 
                    credits: parseInt(credits), 
                    grade: grade 
                },
                success: function(response) {
                    console.log("Server Response:", response);
                    loadGrades();  // Refresh the table
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                    alert("Failed to add grade.");
                }
            });

            $("#courseName").val("");
            $("#credits").val("");
            $("#grade").val("A+");
        }

        function loadGrades() {
            $.get("/grades/all", function(grades) {
                let table = $("#gradesTable");
                table.empty();
                grades.forEach(g => {
                    table.append(`<tr><td>${g.courseName}</td><td>${g.credits}</td><td>${g.grade}</td></tr>`);
                });
            });
        }

        function calculateGPA() {
            $.get("/grades/gpa", function(gpa) {
                $("#gpa").text(gpa.toFixed(2));
            });
        }

        $(document).ready(function() {
            loadGrades();
        });
    </script>
</body>
</html>
